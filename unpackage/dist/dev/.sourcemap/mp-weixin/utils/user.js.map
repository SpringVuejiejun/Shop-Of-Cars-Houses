{"version":3,"file":"user.js","sources":["utils/user.js"],"sourcesContent":["// 清除本地缓存\n// uni.clearStorageSync();\n\n// 用户数据管理工具\nconst userData = {\n\t// 用户信息\n\tuserInfo: {\n\t\tbalance: 100000000, // 初始余额30万\n\t\tlastSignIn: null, // 上次签到时间\n\t\torders: [], // 订单列表\n\t\tgameTimes: 10, // 游戏次数\n\t\tgameRecords: [], // 游戏记录\n\t\tcoupons: [], // 优惠券列表\n\t\tavatar: 'https://img.picui.cn/free/2025/05/09/681e03456a7b0.jpg',\n\t\tnickname: '福布斯在榜者',\n\t\tID: '88888888',\n\t\tphone: '',\n\t\tfrozenAmount: 3000000, // 冻结金额\n\t\taddressList: [] // 地址列表\n\t},\n\n\t// 获取地址列表\n\tgetAddressList() {\n\t\treturn this.userInfo.addressList || []\n\t},\n\n\t// 添加地址\n\taddAddress(address) {\n\t\t// 如果是第一個地址，設置為默認\n\t\tif (this.userInfo.addressList.length === 0) {\n\t\t\taddress.isDefault = true\n\t\t}\n\t\tthis.userInfo.addressList.push(address)\n\t\tthis.saveUserInfo()\n\t\treturn this.userInfo.addressList\n\t},\n\n\t// 删除地址\n\tdeleteAddress(addressId) {\n\t\tconst index = this.userInfo.addressList.findIndex(item => item.id === addressId)\n\t\tif (index > -1) {\n\t\t\t// 如果刪除的是默認地址，且還有其他地址，則將第一個地址設為默認\n\t\t\tif (this.userInfo.addressList[index].isDefault && this.userInfo.addressList.length > 1) {\n\t\t\t\tthis.userInfo.addressList[0].isDefault = true\n\t\t\t}\n\t\t\tthis.userInfo.addressList.splice(index, 1)\n\t\t\tthis.saveUserInfo()\n\t\t}\n\t\treturn this.userInfo.addressList\n\t},\n\n\t// 更新地址\n\tupdateAddress(address) {\n\t\tconst index = this.userInfo.addressList.findIndex(item => item.id === address.id)\n\t\tif (index > -1) {\n\t\t\tthis.userInfo.addressList[index] = address\n\t\t\tthis.saveUserInfo()\n\t\t}\n\t\treturn this.userInfo.addressList\n\t},\n\n\t// 设置默认地址\n\tsetDefaultAddress(addressId) {\n\t\tthis.userInfo.addressList.forEach(item => {\n\t\t\titem.isDefault = item.id === addressId\n\t\t})\n\t\tthis.saveUserInfo()\n\t},\n\n\t// 获取游戏记录\n\tgetGameRecords() {\n\t\tconst userInfo = this.getUserInfo()\n\t\treturn userInfo.gameRecords || []\n\t},\n\n\t// 获得游戏次数\n\tgetGameTimes(){\n\t\treturn this.userInfo.gameTimes\n\t},\n\t\n\t// 获取用户信息\n\tgetUserInfo() {\n\t\ttry {\n\t\t\tconst userInfo = uni.getStorageSync('userInfo')\n\t\t\tif (userInfo) {\n\t\t\t\tthis.userInfo = JSON.parse(userInfo)\n\t\t\t}\n\t\t\treturn this.userInfo\n\t\t} catch (e) {\n\t\t\tconsole.error('获取用戶信息失败：', e)\n\t\t\treturn this.userInfo\n\t\t}\n\t},\n\n\tupdateUserInfo(userInfo){\n\t\tthis.userInfo = userInfo\n\t\tthis.saveUserInfo()\n\t},\n\t\n\t// 保存用户信息\n\tsaveUserInfo() {\n\t\ttry {\n\t\t\tuni.setStorageSync('userInfo', JSON.stringify(this.userInfo))\n\t\t} catch (e) {\n\t\t\tconsole.error('保存用戶信息失败：', e)\n\t\t}\n\t},\n\t\n\t// 签到\n\tsignIn() {\n\t\tconst today = new Date().toDateString()\n\t\tif (this.userInfo.lastSignIn === today) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmessage: '今天已经签到过了'\n\t\t\t}\n\t\t}\n\t\t\n\t\tthis.userInfo.balance += 50000 // 签到奖励5万\n\t\tthis.userInfo.lastSignIn = today\n\t\tthis.saveUserInfo()\n\t\t\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tmessage: '签到成功，获得5万奖励'\n\t\t}\n\t},\n\t\n\t// 更新余额\n\tupdateBalance(amount) {\n\t\tthis.userInfo.balance += amount\n\t\tthis.saveUserInfo()\n\t},\n\t\n\t// 添加订单\n\taddOrder(order) {\n\t\t// 生成订单号\n\t\tconst orderNo = 'HC' + Date.now().toString().slice(-8)\n\t\t// 设置支付截止时间（24小时后）\n\t\tconst payDeadline = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString()\n\t\t// 设置预计发货时间（支付后3天）\n\t\tconst estimatedDelivery = new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString()\n\t\t\n\t\tconst newOrder = {\n\t\t\tid: orderNo,\n\t\t\tproductId: order.productId,\n\t\t\tproductName: order.productName,\n\t\t\tproductImage: order.productImage,\n\t\t\tsku: order.sku,\n\t\t\tprice: order.price,\n\t\t\tstatus: '待付款',\n\t\t\tcreateTime: new Date().toISOString(),\n\t\t\tpayDeadline: payDeadline,\n\t\t\testimatedDelivery: estimatedDelivery\n\t\t}\n\t\t\n\t\tthis.userInfo.orders.unshift(newOrder)\n\t\tthis.saveUserInfo()\n\t\treturn newOrder\n\t},\n\t\n\t// 获取订单列表\n\tgetOrderList() {\n\t\treturn this.userInfo.orders\n\t},\n\t\n\t// 获取指定状态的订单列表\n\tgetOrdersByStatus(status) {\n\t\tif (status === 'all') {\n\t\t\treturn this.userInfo.orders\n\t\t}\n\t\treturn this.userInfo.orders.filter(order => order.status === status)\n\t},\n\t\n\t// 获取订单详情\n\tgetOrderById(orderId) {\n\t\treturn this.userInfo.orders.find(order => order.id === orderId)\n\t},\n\t\n\t// 更新订单\n\tupdateOrder(updatedOrder) {\n\t\tconst index = this.userInfo.orders.findIndex(order => order.id === updatedOrder.id)\n\t\tif (index !== -1) {\n\t\t\tthis.userInfo.orders[index] = updatedOrder\n\t\t\tthis.saveUserInfo()\n\t\t\treturn true\n\t\t}\n\t\treturn false\n\t},\n\t\n\t// 删除订单\n\tdeleteOrder(orderId) {\n\t\tconst index = this.userInfo.orders.findIndex(order => order.id === orderId)\n\t\tif (index !== -1) {\n\t\t\tthis.userInfo.orders.splice(index, 1)\n\t\t\tthis.saveUserInfo()\n\t\t\treturn true\n\t\t}\n\t\treturn false\n\t},\n\t\n\t// 取消订单\n\tcancelOrder(orderId) {\n\t\tconst order = this.getOrderById(orderId)\n\t\tif (order && order.status === '待付款') {\n\t\t\torder.status = '已取消'\n\t\t\tthis.updateOrder(order)\n\t\t\treturn true\n\t\t}\n\t\treturn false\n\t},\n\t\n\t// 确认收货\n\tconfirmReceive(orderId) {\n\t\tconst order = this.getOrderById(orderId)\n\t\tif (order && order.status === '待收货') {\n\t\t\torder.status = '已完成'\n\t\t\tthis.updateOrder(order)\n\t\t\treturn true\n\t\t}\n\t\treturn false\n\t},\n\t\n\t// 获取订单状态统计\n\tgetOrderStatusCount() {\n\t\tconst counts = {\n\t\t\tall: this.userInfo.orders.length,\n\t\t\t待付款: 0,\n\t\t\t待发货: 0,\n\t\t\t待收货: 0,\n\t\t\t已完成: 0,\n\t\t\t已取消: 0\n\t\t}\n\t\t\n\t\tthis.userInfo.orders.forEach(order => {\n\t\t\tcounts[order.status]++\n\t\t})\n\t\t\n\t\treturn counts\n\t},\n\t\n\t// 更新游戏次数\n\tupdateGameTimes(times) {\n\t\tconst userInfo = this.getUserInfo()\n\t\tuserInfo.gameTimes = times\n\t\tthis.saveUserInfo()\n\t},\n\t\n\t// 添加游戏记录\n\taddGameRecord(record) {\n\t\tconst userInfo = this.getUserInfo()\n\t\tif (!userInfo.gameRecords) {\n\t\t\tuserInfo.gameRecords = []\n\t\t}\n\t\tuserInfo.gameRecords.unshift(record)\n\t\tthis.saveUserInfo()\n\t},\n\t\n\t// 添加优惠券\n\taddCoupon(coupon) {\n\t\tconst userInfo = this.getUserInfo()\n\t\tif (!userInfo.coupons) {\n\t\t\tuserInfo.coupons = []\n\t\t}\n\t\tuserInfo.coupons.push(coupon)\n\t\tthis.saveUserInfo()\n\t},\n\t\n\t// 获取可用优惠券\n\tgetValidCoupons() {\n\t\tconst userInfo = this.getUserInfo()\n\t\tif (!userInfo.coupons) return []\n\t\tconst now = new Date()\n\t\treturn userInfo.coupons.filter(coupon => {\n\t\t\treturn new Date(coupon.expireTime) > now\n\t\t})\n\t},\n\t\n\t// 使用优惠券\n\tuseCoupon(couponId) {\n\t\tconst userInfo = this.getUserInfo()\n\t\tif (!userInfo.coupons) return false\n\t\tconst index = userInfo.coupons.findIndex(coupon => coupon.id === couponId)\n\t\tif (index === -1) return false\n\t\tuserInfo.coupons.splice(index, 1)\n\t\tthis.saveUserInfo()\n\t\treturn true\n\t}\n}\n\nexport default userData "],"names":["uni"],"mappings":"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"}