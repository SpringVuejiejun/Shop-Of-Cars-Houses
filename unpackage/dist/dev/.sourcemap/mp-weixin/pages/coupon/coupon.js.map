{"version":3,"file":"coupon.js","sources":["pages/coupon/coupon.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY291cG9uL2NvdXBvbi52dWU"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<!-- 优惠券标签页 -->\n\t\t<view class=\"tabs\">\n\t\t\t<view class=\"tab-item\" :class=\"{ active: currentTab === 'valid' }\" @tap=\"switchTab('valid')\">\n\t\t\t\t<text>可用优惠券</text>\n\t\t\t\t<text class=\"count\">({{validCoupons.length}})</text>\n\t\t\t</view>\n\t\t\t<view class=\"tab-item\" :class=\"{ active: currentTab === 'used' }\" @tap=\"switchTab('used')\">\n\t\t\t\t<text>已使用</text>\n\t\t\t\t<text class=\"count\">({{usedCoupons.length}})</text>\n\t\t\t</view>\n\t\t\t<view class=\"tab-item\" :class=\"{ active: currentTab === 'expired' }\" @tap=\"switchTab('expired')\">\n\t\t\t\t<text>已过期</text>\n\t\t\t\t<text class=\"count\">({{expiredCoupons.length}})</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 优惠券列表 -->\n\t\t<view class=\"coupon-list\">\n\t\t\t<view class=\"coupon-item\" v-for=\"(coupon, index) in currentCoupons\" :key=\"index\">\n\t\t\t\t<view class=\"left\">\n\t\t\t\t\t<text class=\"value\">¥{{coupon.value / 10000}}万</text>\n\t\t\t\t\t<text class=\"condition\">满{{coupon.value * 2 / 10000}}万可用</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"right\">\n\t\t\t\t\t<text class=\"expire\">有效期至：{{formatDate(coupon.expireTime)}}</text>\n\t\t\t\t\t<button class=\"use-btn\" v-if=\"currentTab === 'valid'\" @tap=\"useCoupon(coupon.id)\">立即使用</button>\n\t\t\t\t\t<text class=\"status\" v-else>{{currentTab === 'used' ? '已使用' : '已过期'}}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 空状态 -->\n\t\t<view class=\"empty\" v-if=\"currentCoupons.length === 0\">\n\t\t\t<image class=\"empty-image\" src=\"https://img.picui.cn/free/2025/05/09/681e034f790dc.jpg\"></image>\n\t\t\t<text class=\"empty-text\">暂无优惠券</text>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport userData from '@/utils/user.js'\n\t\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tcurrentTab: 'valid',\n\t\t\t\tvalidCoupons: [],\n\t\t\t\tusedCoupons: [],\n\t\t\t\texpiredCoupons: []\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\tcurrentCoupons() {\n\t\t\t\tswitch(this.currentTab) {\n\t\t\t\t\tcase 'valid':\n\t\t\t\t\t\treturn this.validCoupons\n\t\t\t\t\tcase 'used':\n\t\t\t\t\t\treturn this.usedCoupons\n\t\t\t\t\tcase 'expired':\n\t\t\t\t\t\treturn this.expiredCoupons\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn []\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonShow() {\n\t\t\tthis.loadCoupons()\n\t\t},\n\t\tmethods: {\n\t\t\tloadCoupons() {\n\t\t\t\tconst userInfo = userData.getUserInfo()\n\t\t\t\tconst now = new Date()\n\t\t\t\t\n\t\t\t\t// 获取所有优惠券\n\t\t\t\tconst allCoupons = userInfo.coupons || []\n\t\t\t\t\n\t\t\t\t// 分类优惠券\n\t\t\t\tthis.validCoupons = allCoupons.filter(coupon => {\n\t\t\t\t\treturn new Date(coupon.expireTime) > now && !coupon.used\n\t\t\t\t})\n\t\t\t\t\n\t\t\t\tthis.usedCoupons = allCoupons.filter(coupon => coupon.used)\n\t\t\t\t\n\t\t\t\tthis.expiredCoupons = allCoupons.filter(coupon => {\n\t\t\t\t\treturn new Date(coupon.expireTime) <= now && !coupon.used\n\t\t\t\t})\n\t\t\t},\n\t\t\tswitchTab(tab) {\n\t\t\t\tthis.currentTab = tab\n\t\t\t},\n\t\t\tformatDate(dateStr) {\n\t\t\t\tconst date = new Date(dateStr)\n\t\t\t\treturn `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`\n\t\t\t},\n\t\t\tuseCoupon(couponId) {\n\t\t\t\tif (userData.useCoupon(couponId)) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '使用成功',\n\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t})\n\t\t\t\t\tthis.loadCoupons()\n\t\t\t\t} else {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '使用失败',\n\t\t\t\t\t\ticon: 'error'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t.container {\n\t\tpadding: 20rpx;\n\t\tbackground-color: #f5f5f5;\n\t\tmin-height: 100vh;\n\t}\n\t\n\t.tabs {\n\t\tdisplay: flex;\n\t\tbackground-color: #fff;\n\t\tborder-radius: 20rpx;\n\t\tpadding: 20rpx;\n\t\tmargin-bottom: 20rpx;\n\t}\n\t\n\t.tab-item {\n\t\tflex: 1;\n\t\ttext-align: center;\n\t\tfont-size: 28rpx;\n\t\tcolor: #666;\n\t\tposition: relative;\n\t}\n\t\n\t.tab-item.active {\n\t\tcolor: #1a1a1a;\n\t\tfont-weight: bold;\n\t}\n\t\n\t.tab-item.active::after {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tbottom: -10rpx;\n\t\tleft: 50%;\n\t\ttransform: translateX(-50%);\n\t\twidth: 40rpx;\n\t\theight: 4rpx;\n\t\tbackground-color: #1a1a1a;\n\t\tborder-radius: 2rpx;\n\t}\n\t\n\t.tab-item .count {\n\t\tfont-size: 24rpx;\n\t\tcolor: #999;\n\t\tmargin-left: 4rpx;\n\t}\n\t\n\t.coupon-list {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\t\n\t.coupon-item {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding: 30rpx;\n\t\tbackground-color: #fff;\n\t\tborder-radius: 20rpx;\n\t\tmargin-bottom: 20rpx;\n\t}\n\t\n\t.coupon-item:last-child {\n\t\tmargin-bottom: 0;\n\t}\n\t\n\t.coupon-item .left {\n\t\ttext-align: center;\n\t}\n\t\n\t.coupon-item .value {\n\t\tfont-size: 48rpx;\n\t\tcolor: #FF4D4F;\n\t\tfont-weight: bold;\n\t\tdisplay: block;\n\t}\n\t\n\t.coupon-item .condition {\n\t\tfont-size: 24rpx;\n\t\tcolor: #666;\n\t}\n\t\n\t.coupon-item .right {\n\t\ttext-align: right;\n\t}\n\t\n\t.coupon-item .expire {\n\t\tfont-size: 24rpx;\n\t\tcolor: #999;\n\t\tdisplay: block;\n\t\tmargin-bottom: 10rpx;\n\t}\n\t\n\t.coupon-item .use-btn {\n\t\twidth: 160rpx;\n\t\theight: 50rpx;\n\t\tline-height: 50rpx;\n\t\tbackground-color: #FF4D4F;\n\t\tcolor: #fff;\n\t\tfont-size: 24rpx;\n\t\tborder-radius: 25rpx;\n\t}\n\t\n\t.coupon-item .status {\n\t\tfont-size: 24rpx;\n\t\tcolor: #999;\n\t}\n\t\n\t.empty {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tpadding: 100rpx 0;\n\t}\n\t\n\t.empty-image {\n\t\twidth: 200rpx;\n\t\theight: 200rpx;\n\t\tmargin-bottom: 20rpx;\n\t}\n\t\n\t.empty-text {\n\t\tfont-size: 28rpx;\n\t\tcolor: #999;\n\t}\n</style> ","import MiniProgramPage from 'D:/learnRoute/procedure/wechat-Pro-demo-1/pages/coupon/coupon.vue'\nwx.createPage(MiniProgramPage)"],"names":["userData","uni"],"mappings":";;;AA4CC,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,YAAY;AAAA,MACZ,cAAc,CAAE;AAAA,MAChB,aAAa,CAAE;AAAA,MACf,gBAAgB,CAAC;AAAA,IAClB;AAAA,EACA;AAAA,EACD,UAAU;AAAA,IACT,iBAAiB;AAChB,cAAO,KAAK,YAAU;AAAA,QACrB,KAAK;AACJ,iBAAO,KAAK;AAAA,QACb,KAAK;AACJ,iBAAO,KAAK;AAAA,QACb,KAAK;AACJ,iBAAO,KAAK;AAAA,QACb;AACC,iBAAO,CAAC;AAAA,MACV;AAAA,IACD;AAAA,EACA;AAAA,EACD,SAAS;AACR,SAAK,YAAY;AAAA,EACjB;AAAA,EACD,SAAS;AAAA,IACR,cAAc;AACb,YAAM,WAAWA,WAAQ,SAAC,YAAY;AACtC,YAAM,MAAM,oBAAI,KAAK;AAGrB,YAAM,aAAa,SAAS,WAAW,CAAC;AAGxC,WAAK,eAAe,WAAW,OAAO,YAAU;AAC/C,eAAO,IAAI,KAAK,OAAO,UAAU,IAAI,OAAO,CAAC,OAAO;AAAA,OACpD;AAED,WAAK,cAAc,WAAW,OAAO,YAAU,OAAO,IAAI;AAE1D,WAAK,iBAAiB,WAAW,OAAO,YAAU;AACjD,eAAO,IAAI,KAAK,OAAO,UAAU,KAAK,OAAO,CAAC,OAAO;AAAA,OACrD;AAAA,IACD;AAAA,IACD,UAAU,KAAK;AACd,WAAK,aAAa;AAAA,IAClB;AAAA,IACD,WAAW,SAAS;AACnB,YAAM,OAAO,IAAI,KAAK,OAAO;AAC7B,aAAO,GAAG,KAAK,YAAW,CAAE,IAAI,OAAO,KAAK,SAAQ,IAAK,CAAC,EAAE,SAAS,GAAG,GAAG,CAAC,IAAI,OAAO,KAAK,SAAS,EAAE,SAAS,GAAG,GAAG,CAAC;AAAA,IACvH;AAAA,IACD,UAAU,UAAU;AACnB,UAAIA,WAAQ,SAAC,UAAU,QAAQ,GAAG;AACjCC,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,SACN;AACD,aAAK,YAAY;AAAA,aACX;AACNA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,SACN;AAAA,MACF;AAAA,IACD;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9GD,GAAG,WAAW,eAAe;"}