{"version":3,"file":"bargain.js","sources":["pages/son_pages/bargain.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc29uX3BhZ2VzL2JhcmdhaW4udnVl"],"sourcesContent":["<template>\r\n\t<view class=\"container\" v-if=\"product\">\r\n\t\t<!-- 商品信息 -->\r\n\t\t<view class=\"product-info\">\r\n\t\t\t<image :src=\"product.images[0]\" mode=\"aspectFill\" class=\"product-image\"></image>\r\n\t\t\t<view class=\"info-right\">\r\n\t\t\t\t<text class=\"product-name\">{{product.name}}</text>\r\n\t\t\t\t<view class=\"price-info\">\r\n\t\t\t\t\t<text class=\"current-price\">¥{{currentPrice}}万</text>\r\n\t\t\t\t\t<text class=\"original-price\">原价：¥{{product.skus[0].price}}万</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<text class=\"min-price\">最低价：¥{{product.minPrice}}万</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 砍价进度 -->\r\n\t\t<view class=\"bargain-progress\">\r\n\t\t\t<view class=\"progress-title\">\r\n\t\t\t\t<text>砍价进度</text>\r\n\t\t\t\t<text class=\"bargain-count\">已砍{{bargainCount}}次</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"progress-bar\">\r\n\t\t\t\t<view class=\"progress-inner\" :style=\"{width: progress + '%'}\"></view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"progress-text\">\r\n\t\t\t\t<text>已砍{{(product.skus[0].price - currentPrice).toFixed(2)}}万</text>\r\n\t\t\t\t<text>还需砍{{(currentPrice - product.minPrice).toFixed(2)}}万</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 砍价记录 -->\r\n\t\t<view class=\"bargain-records\">\r\n\t\t\t<view class=\"records-title\">砍价记录</view>\r\n\t\t\t<view class=\"record-list\">\r\n\t\t\t\t<view class=\"record-item\" v-for=\"(item, index) in records\" :key=\"index\">\r\n\t\t\t\t\t<text class=\"record-name\">{{item.name}}</text>\r\n\t\t\t\t\t<text class=\"record-amount\">砍掉¥{{item.amount}}万</text>\r\n\t\t\t\t\t<text class=\"record-time\">{{item.time}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 底部操作栏 -->\r\n\t\t<view class=\"bottom-bar\">\r\n\t\t\t<button class=\"bargain-btn\" @tap=\"doBargain\" :disabled=\"isBargaining\">立即砍价</button>\r\n\t\t\t<button class=\"buy-btn\" @tap=\"buyNow\">立即购买</button>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport userData from '@/utils/user.js'\r\n\timport products from '@/utils/products.js'\t\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tproduct: null,\r\n\t\t\t\tcurrentPrice: 0,\r\n\t\t\t\tbargainCount: 0,\r\n\t\t\t\trecords: [],\r\n\t\t\t\tisBargaining: false,\r\n\t\t\t\tselectedSku: null,\r\n\t\t\t\tuserBalance: 0,\r\n\t\t\t\tmaxBargainCount: 5 // 最大砍价次数\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tprogress() {\r\n\t\t\t\tif (!this.product) return 0\r\n\t\t\t\tconst total = this.product.skus[0].price - this.product.minPrice\r\n\t\t\t\tconst current = this.product.skus[0].price - this.currentPrice\r\n\t\t\t\treturn (current / total) * 100\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(options) {\r\n\t\t\tthis.product = products.getProductById(options.id)\r\n\t\t\tif (!this.product) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '商品不存在',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t}, 1500)\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tthis.selectedSku = this.product.skus[0]\r\n\t\t\tthis.userBalance = userData.getUserInfo().balance / 10000\r\n\t\t\tthis.currentPrice = this.product.skus[0].price\r\n\t\t\tthis.loadRecords()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tloadRecords() {\r\n\t\t\t\t// 模拟加载砍价记录\r\n\t\t\t\tthis.records = [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: '用户A',\r\n\t\t\t\t\t\tamount: '5.00',\r\n\t\t\t\t\t\ttime: '10:30'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: '用户B',\r\n\t\t\t\t\t\tamount: '3.50',\r\n\t\t\t\t\t\ttime: '10:28'\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\tdoBargain() {\r\n\t\t\t\tif (this.isBargaining) return\r\n\t\t\t\tif (this.bargainCount >= this.maxBargainCount) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '已达到最大砍价次数',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tif (this.currentPrice <= this.product.minPrice) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '已砍到最低价',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.isBargaining = true\r\n\t\t\t\t\r\n\t\t\t\t// 模拟砍价过程\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tconst minAmount = 5\r\n\t\t\t\t\tconst maxAmount = 30\r\n\t\t\t\t\tconst amount = (Math.random() * (maxAmount - minAmount) + minAmount).toFixed(0)\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.currentPrice = Math.max(this.product.minPrice, this.currentPrice - parseFloat(amount))\r\n\t\t\t\t\tthis.bargainCount++\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 添加砍价记录\r\n\t\t\t\t\tthis.records.unshift({\r\n\t\t\t\t\t\tname: '我',\r\n\t\t\t\t\t\tamount: amount,\r\n\t\t\t\t\t\ttime: new Date().toLocaleTimeString()\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.isBargaining = false\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.currentPrice <= this.product.minPrice) {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '恭喜砍到最低价！',\r\n\t\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this.bargainCount >= this.maxBargainCount) {\r\n\t\t\t\t\t\tthis.isBargaining = true // 禁用砍价按钮\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 150)\r\n\t\t\t},\r\n\t\t\tbuyNow() {\r\n\t\t\t\tif (this.userBalance < this.selectedSku.price) {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\ttitle: '余额不足',\r\n\t\t\t\t\t\tcontent: '您的账户余额不足，请继续努力',\r\n\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\tconfirmText: '好的',\r\n\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\tif(res.confirm)\r\n\t\t\t\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 创建订单\r\n\t\t\t\tconst order = {\r\n\t\t\t\t\tid: Date.now(),\r\n\t\t\t\t\tproductId: this.product.id,\r\n\t\t\t\t\tproductName: this.product.name,\r\n\t\t\t\t\tproductImage: this.product.images[0],\r\n\t\t\t\t\tsku: this.selectedSku,\r\n\t\t\t\t\tprice: this.currentPrice,\r\n\t\t\t\t\tstatus: '待付款',\r\n\t\t\t\t\tcreateTime: new Date().toISOString()\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 添加订单\r\n\t\t\t\tuserData.addOrder(order)\r\n\t\t\t\t\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '订单已提交',\r\n\t\t\t\t\ticon: 'success'\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t}, 1500)\r\n\r\n\t\t\t\t// uni.navigateTo({\r\n\t\t\t\t// \turl: '/pages/detail/detail?id=' + this.product.id\r\n\t\t\t\t// })\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.container {\r\n\t\tpadding: 20rpx;\r\n\t\tbackground-color: #f5f5f5;\r\n\t\tmin-height: 100vh;\r\n\t\tpadding-bottom: 120rpx;\r\n\t}\r\n\t\r\n\t.product-info {\r\n\t\tdisplay: flex;\r\n\t\tbackground-color: #fff;\r\n\t\tpadding: 20rpx;\r\n\t\tborder-radius: 10rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\t\r\n\t.product-image {\r\n\t\twidth: 200rpx;\r\n\t\theight: 200rpx;\r\n\t\tborder-radius: 8rpx;\r\n\t\tmargin-right: 20rpx;\r\n\t}\r\n\t\r\n\t.info-right {\r\n\t\tflex: 1;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: space-between;\r\n\t}\r\n\t\r\n\t.product-name {\r\n\t\tfont-size: 32rpx;\r\n\t\tcolor: #333;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\t\r\n\t.price-info {\r\n\t\tdisplay: flex;\r\n\t\talign-items: baseline;\r\n\t}\r\n\t\r\n\t.current-price {\r\n\t\tfont-size: 36rpx;\r\n\t\tcolor: #FF4D4F;\r\n\t\tfont-weight: bold;\r\n\t\tmargin-right: 20rpx;\r\n\t}\r\n\t\r\n\t.original-price {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t\ttext-decoration: line-through;\r\n\t}\r\n\t\r\n\t.min-price {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #666;\r\n\t}\r\n\t\r\n\t.bargain-progress {\r\n\t\tbackground-color: #fff;\r\n\t\tpadding: 20rpx;\r\n\t\tborder-radius: 10rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\t\r\n\t.progress-title {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\t\r\n\t.bargain-count {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #666;\r\n\t}\r\n\t\r\n\t.progress-bar {\r\n\t\theight: 20rpx;\r\n\t\tbackground-color: #f5f5f5;\r\n\t\tborder-radius: 10rpx;\r\n\t\toverflow: hidden;\r\n\t\tmargin-bottom: 10rpx;\r\n\t}\r\n\t\r\n\t.progress-inner {\r\n\t\theight: 100%;\r\n\t\tbackground-color: #FF4D4F;\r\n\t\tborder-radius: 10rpx;\r\n\t\ttransition: width 0.3s;\r\n\t}\r\n\t\r\n\t.progress-text {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #666;\r\n\t}\r\n\t\r\n\t.bargain-records {\r\n\t\tbackground-color: #fff;\r\n\t\tpadding: 20rpx;\r\n\t\tborder-radius: 10rpx;\r\n\t}\r\n\t\r\n\t.records-title {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #333;\r\n\t\tfont-weight: bold;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\t\r\n\t.record-item {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tpadding: 20rpx 0;\r\n\t\tborder-bottom: 1rpx solid #f5f5f5;\r\n\t}\r\n\t\r\n\t.record-name {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #333;\r\n\t}\r\n\t\r\n\t.record-amount {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #FF4D4F;\r\n\t}\r\n\t\r\n\t.record-time {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\t\r\n\t.bottom-bar {\r\n\t\tposition: fixed;\r\n\t\tbottom: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\theight: 100rpx;\r\n\t\tbackground-color: #fff;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tpadding: 0 20rpx;\r\n\t\tbox-shadow: 0 -2rpx 10rpx rgba(0,0,0,0.1);\r\n\t}\r\n\t\r\n\t.bargain-btn {\r\n\t\tflex: 1;\r\n\t\theight: 80rpx;\r\n\t\tline-height: 80rpx;\r\n\t\ttext-align: center;\r\n\t\tbackground-color: #FF4D4F;\r\n\t\tcolor: #fff;\r\n\t\tborder-radius: 40rpx;\r\n\t\tmargin-right: 20rpx;\r\n\t}\r\n\t\r\n\t.buy-btn {\r\n\t\tflex: 1;\r\n\t\theight: 80rpx;\r\n\t\tline-height: 80rpx;\r\n\t\ttext-align: center;\r\n\t\tbackground-color: #1a1a1a;\r\n\t\tcolor: #fff;\r\n\t\tborder-radius: 40rpx;\r\n\t}\r\n\t\r\n\t.bargain-btn[disabled] {\r\n\t\tbackground-color: #ccc;\r\n\t}\r\n</style> ","import MiniProgramPage from 'D:/learnRoute/fullStack/Shop-Of-Cars-Houses/frontend/pages/son_pages/bargain.vue'\nwx.createPage(MiniProgramPage)"],"names":["products","uni","userData"],"mappings":"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"}