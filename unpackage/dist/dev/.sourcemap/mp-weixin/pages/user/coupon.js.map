{"version":3,"file":"coupon.js","sources":["pages/user/coupon.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9jb3Vwb24udnVl"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<!-- 优惠券标签页 -->\r\n\t\t<view class=\"tabs\">\r\n\t\t\t<view class=\"tab-item\" :class=\"{ active: currentTab === 'valid' }\" @tap=\"switchTab('valid')\">\r\n\t\t\t\t<text>可用优惠券</text>\r\n\t\t\t\t<text class=\"count\">({{validCoupons.length}})</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"tab-item\" :class=\"{ active: currentTab === 'used' }\" @tap=\"switchTab('used')\">\r\n\t\t\t\t<text>已使用</text>\r\n\t\t\t\t<text class=\"count\">({{usedCoupons.length}})</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"tab-item\" :class=\"{ active: currentTab === 'expired' }\" @tap=\"switchTab('expired')\">\r\n\t\t\t\t<text>已过期</text>\r\n\t\t\t\t<text class=\"count\">({{expiredCoupons.length}})</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 优惠券列表 -->\r\n\t\t<view class=\"coupon-list\">\r\n\t\t\t<view class=\"coupon-item\" v-for=\"(coupon, index) in currentCoupons\" :key=\"index\">\r\n\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t<text class=\"value\">¥{{coupon.value / 10000}}万</text>\r\n\t\t\t\t\t<text class=\"condition\">满{{coupon.value * 2 / 10000}}万可用</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t<text class=\"expire\">有效期至：{{formatDate(coupon.expireTime)}}</text>\r\n\t\t\t\t\t<button class=\"use-btn\" v-if=\"currentTab === 'valid'\" @tap=\"useCoupon(coupon.id)\">立即使用</button>\r\n\t\t\t\t\t<text class=\"status\" v-else>{{currentTab === 'used' ? '已使用' : '已过期'}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 空状态 -->\r\n\t\t<view class=\"empty\" v-if=\"currentCoupons.length === 0\">\r\n\t\t\t<image class=\"empty-image\" src=\"https://img.picui.cn/free/2025/05/09/681e034f790dc.jpg\"></image>\r\n\t\t\t<text class=\"empty-text\">暂无优惠券</text>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport userData from '@/utils/user.js'\r\n\t\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tcurrentTab: 'valid',\r\n\t\t\t\tvalidCoupons: [],\r\n\t\t\t\tusedCoupons: [],\r\n\t\t\t\texpiredCoupons: []\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tcurrentCoupons() {\r\n\t\t\t\tswitch(this.currentTab) {\r\n\t\t\t\t\tcase 'valid':\r\n\t\t\t\t\t\treturn this.validCoupons\r\n\t\t\t\t\tcase 'used':\r\n\t\t\t\t\t\treturn this.usedCoupons\r\n\t\t\t\t\tcase 'expired':\r\n\t\t\t\t\t\treturn this.expiredCoupons\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn []\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\tthis.loadCoupons()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tloadCoupons() {\r\n\t\t\t\tconst userInfo = userData.getUserInfo()\r\n\t\t\t\tconst now = new Date()\r\n\t\t\t\t\r\n\t\t\t\t// 获取所有优惠券\r\n\t\t\t\tconst allCoupons = userInfo.coupons || []\r\n\t\t\t\t\r\n\t\t\t\t// 分类优惠券\r\n\t\t\t\tthis.validCoupons = allCoupons.filter(coupon => {\r\n\t\t\t\t\treturn new Date(coupon.expireTime) > now && !coupon.used\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tthis.usedCoupons = allCoupons.filter(coupon => coupon.used)\r\n\t\t\t\t\r\n\t\t\t\tthis.expiredCoupons = allCoupons.filter(coupon => {\r\n\t\t\t\t\treturn new Date(coupon.expireTime) <= now && !coupon.used\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tswitchTab(tab) {\r\n\t\t\t\tthis.currentTab = tab\r\n\t\t\t},\r\n\t\t\tformatDate(dateStr) {\r\n\t\t\t\tconst date = new Date(dateStr)\r\n\t\t\t\treturn `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`\r\n\t\t\t},\r\n\t\t\tuseCoupon(couponId) {\r\n\t\t\t\tif (userData.useCoupon(couponId)) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '使用成功',\r\n\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.loadCoupons()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '使用失败',\r\n\t\t\t\t\t\ticon: 'error'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.container {\r\n\t\tpadding: 20rpx;\r\n\t\tbackground-color: #f5f5f5;\r\n\t\tmin-height: 100vh;\r\n\t}\r\n\t\r\n\t.tabs {\r\n\t\tdisplay: flex;\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 20rpx;\r\n\t\tpadding: 20rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\t\r\n\t.tab-item {\r\n\t\tflex: 1;\r\n\t\ttext-align: center;\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #666;\r\n\t\tposition: relative;\r\n\t}\r\n\t\r\n\t.tab-item.active {\r\n\t\tcolor: #1a1a1a;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\t\r\n\t.tab-item.active::after {\r\n\t\tcontent: '';\r\n\t\tposition: absolute;\r\n\t\tbottom: -10rpx;\r\n\t\tleft: 50%;\r\n\t\ttransform: translateX(-50%);\r\n\t\twidth: 40rpx;\r\n\t\theight: 4rpx;\r\n\t\tbackground-color: #1a1a1a;\r\n\t\tborder-radius: 2rpx;\r\n\t}\r\n\t\r\n\t.tab-item .count {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t\tmargin-left: 4rpx;\r\n\t}\r\n\t\r\n\t.coupon-list {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\t\r\n\t.coupon-item {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tpadding: 30rpx;\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 20rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\t\r\n\t.coupon-item:last-child {\r\n\t\tmargin-bottom: 0;\r\n\t}\r\n\t\r\n\t.coupon-item .left {\r\n\t\ttext-align: center;\r\n\t}\r\n\t\r\n\t.coupon-item .value {\r\n\t\tfont-size: 48rpx;\r\n\t\tcolor: #FF4D4F;\r\n\t\tfont-weight: bold;\r\n\t\tdisplay: block;\r\n\t}\r\n\t\r\n\t.coupon-item .condition {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #666;\r\n\t}\r\n\t\r\n\t.coupon-item .right {\r\n\t\ttext-align: right;\r\n\t}\r\n\t\r\n\t.coupon-item .expire {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t\tdisplay: block;\r\n\t\tmargin-bottom: 10rpx;\r\n\t}\r\n\t\r\n\t.coupon-item .use-btn {\r\n\t\twidth: 160rpx;\r\n\t\theight: 50rpx;\r\n\t\tline-height: 50rpx;\r\n\t\tbackground-color: #FF4D4F;\r\n\t\tcolor: #fff;\r\n\t\tfont-size: 24rpx;\r\n\t\tborder-radius: 25rpx;\r\n\t}\r\n\t\r\n\t.coupon-item .status {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\t\r\n\t.empty {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tpadding: 100rpx 0;\r\n\t}\r\n\t\r\n\t.empty-image {\r\n\t\twidth: 200rpx;\r\n\t\theight: 200rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\t\r\n\t.empty-text {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n</style> ","import MiniProgramPage from 'D:/learnRoute/fullStack/Shop-Of-Cars-Houses/frontend/pages/user/coupon.vue'\nwx.createPage(MiniProgramPage)"],"names":["userData","uni"],"mappings":";;;AA4CC,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,YAAY;AAAA,MACZ,cAAc,CAAE;AAAA,MAChB,aAAa,CAAE;AAAA,MACf,gBAAgB,CAAC;AAAA,IAClB;AAAA,EACA;AAAA,EACD,UAAU;AAAA,IACT,iBAAiB;AAChB,cAAO,KAAK,YAAU;AAAA,QACrB,KAAK;AACJ,iBAAO,KAAK;AAAA,QACb,KAAK;AACJ,iBAAO,KAAK;AAAA,QACb,KAAK;AACJ,iBAAO,KAAK;AAAA,QACb;AACC,iBAAO,CAAC;AAAA,MACV;AAAA,IACD;AAAA,EACA;AAAA,EACD,SAAS;AACR,SAAK,YAAY;AAAA,EACjB;AAAA,EACD,SAAS;AAAA,IACR,cAAc;AACb,YAAM,WAAWA,WAAQ,SAAC,YAAY;AACtC,YAAM,MAAM,oBAAI,KAAK;AAGrB,YAAM,aAAa,SAAS,WAAW,CAAC;AAGxC,WAAK,eAAe,WAAW,OAAO,YAAU;AAC/C,eAAO,IAAI,KAAK,OAAO,UAAU,IAAI,OAAO,CAAC,OAAO;AAAA,OACpD;AAED,WAAK,cAAc,WAAW,OAAO,YAAU,OAAO,IAAI;AAE1D,WAAK,iBAAiB,WAAW,OAAO,YAAU;AACjD,eAAO,IAAI,KAAK,OAAO,UAAU,KAAK,OAAO,CAAC,OAAO;AAAA,OACrD;AAAA,IACD;AAAA,IACD,UAAU,KAAK;AACd,WAAK,aAAa;AAAA,IAClB;AAAA,IACD,WAAW,SAAS;AACnB,YAAM,OAAO,IAAI,KAAK,OAAO;AAC7B,aAAO,GAAG,KAAK,YAAW,CAAE,IAAI,OAAO,KAAK,SAAQ,IAAK,CAAC,EAAE,SAAS,GAAG,GAAG,CAAC,IAAI,OAAO,KAAK,SAAS,EAAE,SAAS,GAAG,GAAG,CAAC;AAAA,IACvH;AAAA,IACD,UAAU,UAAU;AACnB,UAAIA,WAAQ,SAAC,UAAU,QAAQ,GAAG;AACjCC,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,SACN;AACD,aAAK,YAAY;AAAA,aACX;AACNA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,SACN;AAAA,MACF;AAAA,IACD;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9GD,GAAG,WAAW,eAAe;"}