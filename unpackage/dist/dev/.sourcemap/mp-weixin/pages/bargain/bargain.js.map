{"version":3,"file":"bargain.js","sources":["pages/bargain/bargain.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYmFyZ2Fpbi9iYXJnYWluLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"container\" v-if=\"product\">\n\t\t<!-- 商品信息 -->\n\t\t<view class=\"product-info\">\n\t\t\t<image :src=\"product.images[0]\" mode=\"aspectFill\" class=\"product-image\"></image>\n\t\t\t<view class=\"info-right\">\n\t\t\t\t<text class=\"product-name\">{{product.name}}</text>\n\t\t\t\t<view class=\"price-info\">\n\t\t\t\t\t<text class=\"current-price\">¥{{currentPrice}}万</text>\n\t\t\t\t\t<text class=\"original-price\">原价：¥{{product.skus[0].price}}万</text>\n\t\t\t\t</view>\n\t\t\t\t<text class=\"min-price\">最低价：¥{{product.minPrice}}万</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 砍价进度 -->\n\t\t<view class=\"bargain-progress\">\n\t\t\t<view class=\"progress-title\">\n\t\t\t\t<text>砍价进度</text>\n\t\t\t\t<text class=\"bargain-count\">已砍{{bargainCount}}次</text>\n\t\t\t</view>\n\t\t\t<view class=\"progress-bar\">\n\t\t\t\t<view class=\"progress-inner\" :style=\"{width: progress + '%'}\"></view>\n\t\t\t</view>\n\t\t\t<view class=\"progress-text\">\n\t\t\t\t<text>已砍{{(product.skus[0].price - currentPrice).toFixed(2)}}万</text>\n\t\t\t\t<text>还需砍{{(currentPrice - product.minPrice).toFixed(2)}}万</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 砍价记录 -->\n\t\t<view class=\"bargain-records\">\n\t\t\t<view class=\"records-title\">砍价记录</view>\n\t\t\t<view class=\"record-list\">\n\t\t\t\t<view class=\"record-item\" v-for=\"(item, index) in records\" :key=\"index\">\n\t\t\t\t\t<text class=\"record-name\">{{item.name}}</text>\n\t\t\t\t\t<text class=\"record-amount\">砍掉¥{{item.amount}}万</text>\n\t\t\t\t\t<text class=\"record-time\">{{item.time}}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 底部操作栏 -->\n\t\t<view class=\"bottom-bar\">\n\t\t\t<button class=\"bargain-btn\" @tap=\"doBargain\" :disabled=\"isBargaining\">立即砍价</button>\n\t\t\t<button class=\"buy-btn\" @tap=\"buyNow\">立即购买</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport userData from '@/utils/user.js'\n\timport products from '@/utils/products.js'\t\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tproduct: null,\n\t\t\t\tcurrentPrice: 0,\n\t\t\t\tbargainCount: 0,\n\t\t\t\trecords: [],\n\t\t\t\tisBargaining: false,\n\t\t\t\tselectedSku: null,\n\t\t\t\tuserBalance: 0,\n\t\t\t\tmaxBargainCount: 5 // 最大砍价次数\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\tprogress() {\n\t\t\t\tif (!this.product) return 0\n\t\t\t\tconst total = this.product.skus[0].price - this.product.minPrice\n\t\t\t\tconst current = this.product.skus[0].price - this.currentPrice\n\t\t\t\treturn (current / total) * 100\n\t\t\t}\n\t\t},\n\t\tonLoad(options) {\n\t\t\tthis.product = products.getProductById(options.id)\n\t\t\tif (!this.product) {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '商品不存在',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tuni.navigateBack()\n\t\t\t\t}, 1500)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis.selectedSku = this.product.skus[0]\n\t\t\tthis.userBalance = userData.getUserInfo().balance / 10000\n\t\t\tthis.currentPrice = this.product.skus[0].price\n\t\t\tthis.loadRecords()\n\t\t},\n\t\tmethods: {\n\t\t\tloadRecords() {\n\t\t\t\t// 模拟加载砍价记录\n\t\t\t\tthis.records = [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: '用户A',\n\t\t\t\t\t\tamount: '5.00',\n\t\t\t\t\t\ttime: '10:30'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: '用户B',\n\t\t\t\t\t\tamount: '3.50',\n\t\t\t\t\t\ttime: '10:28'\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\tdoBargain() {\n\t\t\t\tif (this.isBargaining) return\n\t\t\t\tif (this.bargainCount >= this.maxBargainCount) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '已达到最大砍价次数',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (this.currentPrice <= this.product.minPrice) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '已砍到最低价',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.isBargaining = true\n\t\t\t\t\n\t\t\t\t// 模拟砍价过程\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tconst minAmount = 5\n\t\t\t\t\tconst maxAmount = 30\n\t\t\t\t\tconst amount = (Math.random() * (maxAmount - minAmount) + minAmount).toFixed(0)\n\t\t\t\t\t\n\t\t\t\t\tthis.currentPrice = Math.max(this.product.minPrice, this.currentPrice - parseFloat(amount))\n\t\t\t\t\tthis.bargainCount++\n\t\t\t\t\t\n\t\t\t\t\t// 添加砍价记录\n\t\t\t\t\tthis.records.unshift({\n\t\t\t\t\t\tname: '我',\n\t\t\t\t\t\tamount: amount,\n\t\t\t\t\t\ttime: new Date().toLocaleTimeString()\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\tthis.isBargaining = false\n\t\t\t\t\t\n\t\t\t\t\tif (this.currentPrice <= this.product.minPrice) {\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '恭喜砍到最低价！',\n\t\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.bargainCount >= this.maxBargainCount) {\n\t\t\t\t\t\tthis.isBargaining = true // 禁用砍价按钮\n\t\t\t\t\t}\n\t\t\t\t}, 150)\n\t\t\t},\n\t\t\tbuyNow() {\n\t\t\t\tif (this.userBalance < this.selectedSku.price) {\n\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\ttitle: '余额不足',\n\t\t\t\t\t\tcontent: '您的账户余额不足，请继续努力',\n\t\t\t\t\t\tshowCancel: false,\n\t\t\t\t\t\tconfirmText: '好的',\n\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\tif(res.confirm)\n\t\t\t\t\t\t\t\tuni.navigateBack()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 创建订单\n\t\t\t\tconst order = {\n\t\t\t\t\tid: Date.now(),\n\t\t\t\t\tproductId: this.product.id,\n\t\t\t\t\tproductName: this.product.name,\n\t\t\t\t\tproductImage: this.product.images[0],\n\t\t\t\t\tsku: this.selectedSku,\n\t\t\t\t\tprice: this.currentPrice,\n\t\t\t\t\tstatus: '待付款',\n\t\t\t\t\tcreateTime: new Date().toISOString()\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 更新用户余额\n\t\t\t\tuserData.updateBalance(-this.selectedSku.price * 10000)\n\t\t\t\t// 添加订单\n\t\t\t\tuserData.addOrder(order)\n\t\t\t\t\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '订单已提交',\n\t\t\t\t\ticon: 'success'\n\t\t\t\t})\n\t\t\t\t\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tuni.navigateBack()\n\t\t\t\t}, 1500)\n\n\t\t\t\t// uni.navigateTo({\n\t\t\t\t// \turl: '/pages/detail/detail?id=' + this.product.id\n\t\t\t\t// })\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t.container {\n\t\tpadding: 20rpx;\n\t\tbackground-color: #f5f5f5;\n\t\tmin-height: 100vh;\n\t\tpadding-bottom: 120rpx;\n\t}\n\t\n\t.product-info {\n\t\tdisplay: flex;\n\t\tbackground-color: #fff;\n\t\tpadding: 20rpx;\n\t\tborder-radius: 10rpx;\n\t\tmargin-bottom: 20rpx;\n\t}\n\t\n\t.product-image {\n\t\twidth: 200rpx;\n\t\theight: 200rpx;\n\t\tborder-radius: 8rpx;\n\t\tmargin-right: 20rpx;\n\t}\n\t\n\t.info-right {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tjustify-content: space-between;\n\t}\n\t\n\t.product-name {\n\t\tfont-size: 32rpx;\n\t\tcolor: #333;\n\t\tfont-weight: bold;\n\t}\n\t\n\t.price-info {\n\t\tdisplay: flex;\n\t\talign-items: baseline;\n\t}\n\t\n\t.current-price {\n\t\tfont-size: 36rpx;\n\t\tcolor: #FF4D4F;\n\t\tfont-weight: bold;\n\t\tmargin-right: 20rpx;\n\t}\n\t\n\t.original-price {\n\t\tfont-size: 24rpx;\n\t\tcolor: #999;\n\t\ttext-decoration: line-through;\n\t}\n\t\n\t.min-price {\n\t\tfont-size: 24rpx;\n\t\tcolor: #666;\n\t}\n\t\n\t.bargain-progress {\n\t\tbackground-color: #fff;\n\t\tpadding: 20rpx;\n\t\tborder-radius: 10rpx;\n\t\tmargin-bottom: 20rpx;\n\t}\n\t\n\t.progress-title {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tmargin-bottom: 20rpx;\n\t}\n\t\n\t.bargain-count {\n\t\tfont-size: 24rpx;\n\t\tcolor: #666;\n\t}\n\t\n\t.progress-bar {\n\t\theight: 20rpx;\n\t\tbackground-color: #f5f5f5;\n\t\tborder-radius: 10rpx;\n\t\toverflow: hidden;\n\t\tmargin-bottom: 10rpx;\n\t}\n\t\n\t.progress-inner {\n\t\theight: 100%;\n\t\tbackground-color: #FF4D4F;\n\t\tborder-radius: 10rpx;\n\t\ttransition: width 0.3s;\n\t}\n\t\n\t.progress-text {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tfont-size: 24rpx;\n\t\tcolor: #666;\n\t}\n\t\n\t.bargain-records {\n\t\tbackground-color: #fff;\n\t\tpadding: 20rpx;\n\t\tborder-radius: 10rpx;\n\t}\n\t\n\t.records-title {\n\t\tfont-size: 28rpx;\n\t\tcolor: #333;\n\t\tfont-weight: bold;\n\t\tmargin-bottom: 20rpx;\n\t}\n\t\n\t.record-item {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding: 20rpx 0;\n\t\tborder-bottom: 1rpx solid #f5f5f5;\n\t}\n\t\n\t.record-name {\n\t\tfont-size: 28rpx;\n\t\tcolor: #333;\n\t}\n\t\n\t.record-amount {\n\t\tfont-size: 28rpx;\n\t\tcolor: #FF4D4F;\n\t}\n\t\n\t.record-time {\n\t\tfont-size: 24rpx;\n\t\tcolor: #999;\n\t}\n\t\n\t.bottom-bar {\n\t\tposition: fixed;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\theight: 100rpx;\n\t\tbackground-color: #fff;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding: 0 20rpx;\n\t\tbox-shadow: 0 -2rpx 10rpx rgba(0,0,0,0.1);\n\t}\n\t\n\t.bargain-btn {\n\t\tflex: 1;\n\t\theight: 80rpx;\n\t\tline-height: 80rpx;\n\t\ttext-align: center;\n\t\tbackground-color: #FF4D4F;\n\t\tcolor: #fff;\n\t\tborder-radius: 40rpx;\n\t\tmargin-right: 20rpx;\n\t}\n\t\n\t.buy-btn {\n\t\tflex: 1;\n\t\theight: 80rpx;\n\t\tline-height: 80rpx;\n\t\ttext-align: center;\n\t\tbackground-color: #1a1a1a;\n\t\tcolor: #fff;\n\t\tborder-radius: 40rpx;\n\t}\n\t\n\t.bargain-btn[disabled] {\n\t\tbackground-color: #ccc;\n\t}\n</style> ","import MiniProgramPage from 'D:/learnRoute/procedure/wechat-Pro-demo-1/pages/bargain/bargain.vue'\nwx.createPage(MiniProgramPage)"],"names":["products","uni","userData"],"mappings":"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"}